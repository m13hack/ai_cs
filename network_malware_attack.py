from scapy.all import sniff, IP
import requests

API_KEY = '2399d639231bd6ff55ffd4282ee47b57f5e55d53e89342faa66e51504f480574'#get the api key from virus total website 
VT_URL = "https://www.virustotal.com/vtapi/v2/ip-address/report" #change the ip sdrees to you assigned ip

def check_malicious_ip(ip):
    params = {'apikey': API_KEY, 'ip': ip}
    try:
        response = requests.get(VT_URL, params=params)
        result = response.json()
        if result.get('response_code') == 1:
            positives = len(result.get('detected_urls', []))
            if positives > 0:
                print(f"[ALERT] VirusTotal flagged this IP as malicious: {ip} ({positives} detected malicious URLs)")
            else:
                print(f"[INFO] IP is clean: {ip}")
        else:
            print(f"[INFO] IP not found in VirusTotal database: {ip}")
    except Exception as e:
        print(f"Error checking IP with VirusTotal: {e}")

def packet_handler(packet):
    if packet.haslayer(IP):
        src_ip = packet[IP].src
        dst_ip = packet[IP].dst
        print(f"[INFO] Source IP: {src_ip}, Destination IP: {dst_ip}")
        check_malicious_ip(src_ip)
        check_malicious_ip(dst_ip)

def start_sniffing(interface="Wi-Fi"):
    print(f"[*] Starting IP monitoring on {interface}...")
    sniff(iface=interface, prn=packet_handler, store=False)

if _name_ == "_main_":
    start_sniffing(interface="Wi-Fi")
